## JWT / SESSION

> 로그인의 가장 큰 원칙: 내가 로그인했다는것을 서버거 알고 있어야 한다

- 인증 Authentication - 로그인
(내가 이 사이트 이용자 임을 인증받는것 ) 

- 인가 Authorization
(내 계정으로'만' 할 수 있는 활동시도 , 웹사이트가 내가 로그인 되어 있음을 알고 허가)

### Session
세션 -> 사용자가 로그인에 성공하면 ,서버는 '세션표딱지'를 출력, 이걸 반쪽으로 찢어서 서버가 반쪽갖고 반쪽은 클라이언트(브라우저)에게 전달해준다.
브라우저는 이 표를 sessionID라는 이름의 쿠키로 저장한다.
웹사이에 요청을 보낼떄마다 이 반 표딱지를 실어서 보낸다. 서버는 이 표딱지 중 맞는걸 찾아보고 알맞는게 존재한다면 인가를 허가한다.

하지만 여기서 문제는 메모리위에 표딱지 절반을 두기떄문에 메모리가 날아가면 로그인 유저가 다 사라져버리는 문제가 있다.
또한 ,DB에 저장하면 요청과정이 번거로워지며 서버에 부담으로 작용한다.

이러한 문제를 해결하기 위해 생겨난것이 'JWT'이다.

### JWT (Json Web Token)

JWT도 로그인을 하면 Token이라는 표를 출력에서 브라우저에 전달한다.
이번엔 표를 찢어서 주는것이 아닌 표하나를 그냥준다.( 서버가 기억하지 않고 있다는 말과 동일)

토큰으로 xxxx,yyyy,zzzz이렇게 3부분을 나뉘어져 Token으로 전달한다.
마침표로 3부분 나누어져 있는것은
1. 헤더
2. 페이로드 
3. 서명 

2. 페이로드 : 누가 누구에게 발급했는지 언제까지 유효한지, 서비스가 사용자에게 Token을 통해 공개하기 원하는 내용(닉네임,서비스 상 레벨,관리자여부) 
  서비스 측에 원하는 대로 담을 수 있다. 이렇게 Token을 통해 사용자 정보등의 데이터를 Claim이라 한다 .정보들이 claim에 실려서 오고 이게 그 이후 요청들마다 사용자로부터 서버한테 보내진다.



사용자가 받아서 갖고있는 이런 토큰에 정보들이 들어있으면 서버가 DB에 저장되어있는것을 찾지 않아도 된다.

헤더에는 2가지가 있다 
1.Token의 타임 -jwt 
2.alg - 3번 서명 값을 만드는데 사용 될 알고리즘 지정

1번헤더 2번payload 등 서버에 감춰놓은 비밀값이 암호화 알고리즘에 넣고 돌리면 3번 서명값이 나온다. 이 암호화 알고리즘은 한쪽방향으로만 계산이되도 서버쪽의 비밀값을 모르면 서명 불가능

> 즉 서버는 요청에 '토큰'값이 실려오면 1,2번 값을 서버의 비밀키와 함께 돌려봐서 계산도니 결과 값이 3번 서명값고 일치하는지의 여부에 따라 인가를 허가한다!
